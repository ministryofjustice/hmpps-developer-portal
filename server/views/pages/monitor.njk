{% extends "../partials/layout.njk" %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}

{% set pageTitle = applicationName + " - Monitor" %}
{% set mainClasses = "app-container govuk-body" %}

{% block content %}
  {% set serviceAreas = [] %}
  {% for serviceArea in serviceAreaList %}
    {%- set serviceAreas = (serviceAreas.push({
      value: serviceArea.value,
      text: serviceArea.text,
      selected: serviceArea.selected
    }), serviceAreas) %}
  {% endfor %}

  {% set teams = [] %}
  {% for team in teamList %}
    {%- set teams = (teams.push({
      value: team.value,
      text: team.text,
      selected: team.selected
    }), teams) %}
  {% endfor %}

  {% set products = [] %}
  {% for product in productList %}
    {%- set products = (products.push({
      value: product.value,
      text: product.text,
      selected: product.selected
    }), products) %}
  {% endfor %}

  <h1>Monitor</h1>

  <form>
    <input type="hidden" name="monitorName" id="monitorName" value="{{ monitorName }}">
    <input type="hidden" name="monitorType" id="monitorType" value="{{ monitorType }}">
    <input type="hidden" name="_csrf" id="csrf" value="{{ csrfToken }}">
    <div class="monitor-selectors govuk-button-group">
    {{ govukSelect({
      id: "serviceArea",
      name: "serviceArea",
      label: {
        text: "Service Area"
      },
      items: serviceAreas
    }) }}
    {{ govukButton({
      id: "updateServiceArea",
      name: "updateServiceArea",
      text: "Update",
      element: "button"
    }) }}
    {{ govukSelect({
      id: "team",
      name: "team",
      label: {
        text: "Team"
      },
      items: teams
    }) }}
    {{ govukButton({
      id: "updateTeam",
      name: "updateTeam",
      text: "Update",
      element: "button"
    }) }}
    {{ govukSelect({
      id: "product",
      name: "product",
      label: {
        text: "Product"
      },
      items: products
    }) }}
    {{ govukButton({
      id: "updateProduct",
      name: "updateProduct",
      text: "Update",
      element: "button"
    }) }}
    </div>
    {{ govukCheckboxes({
      classes: "govuk-checkboxes--inline environments",
      name: "environment",
      items: [
        {
          id: "environment-dev",
          value: "dev",
          text: "Dev",
          checked: true
        },
        {
          id: "environment-stage",
          value: "stage",
          text: "Stage",
          checked: true
        },
        {
          id: "environment-test",
          value: "test",
          text: "Test",
          checked: true
        },
        {
          id: "environment-preprod",
          value: "preprod",
          text: "PreProd",
          checked: true
        },
        {
          id: "environment-prod",
          value: "prod",
          text: "Prod",
          checked: true
        },
        {
          id: "status-up",
          value: "up",
          text: "UP",
          checked: true
        },
        {
          id: "status-down",
          value: "down",
          text: "DOWN",
          checked: true
        }
      ]
    }) }}
  </form>

  <table id="statusTable">
    <thead>
      <tr>
        <th>Component</th>
        <th>Env</th>
        <th>Health</th>
        <th>Build</th>
        <th>Up/Down</th>
        <th>Status Updated</th>
      </tr>
    </thead>
    <tbody id="statusRows">
    </tbody>
  </table>

{% endblock %}

{% block bodyEnd %}
  <script type="module" src="/assets/govukFrontendInit.js"></script>
  <script src="/assets/moj/all.js"></script>
  <script src="/assets/js/dayjs/dayjs.min.js"></script>
  <script src="/assets/js/dayjs/plugin/relativeTime.js"></script>
  <script src="/assets/js/monitor.js"></script>
{% endblock %}
